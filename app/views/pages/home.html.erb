<% if user_signed_in? %>
  <div class="welcome">
    <h1>Bienvenue <%= current_user.username %></h1>
  </div>

  <!-- 🗓️ Sélecteur de période -->
  <div class="period-selector">
    <%= form_with url: root_path, method: :get, local: true do |f| %>
      <label for="start_date">Début :</label>
      <%= date_field_tag :start_date, @start_date %>

      <label for="end_date">Fin :</label>
      <%= date_field_tag :end_date, @end_date %>

      <%= submit_tag "Filtrer", class: "btn" %>
    <% end %>
  </div>

  <!-- 📊 Graphique -->
  <div class="chart-container">
    <canvas id="financesChart"
      data-controller="simple-chart"
      data-simple-chart-chart-id-value="financesChart"
      data-simple-chart-available-value="<%= @available_balance || 0 %>"
      data-simple-chart-expenses-value="<%= @total_expenses || 0 %>"
      data-simple-chart-savings-value="<%= @savings || 0 %>">
    </canvas>
  </div>

  <!-- 💰 Totaux -->
  <div class="totals">
    <p class="treasury">Trésorerie : <strong><%= number_to_currency(@total_revenues || 0) %></strong></p>
    <p class="expenses">Total dépenses : <strong><%= number_to_currency(@total_expenses || 0) %></strong></p>
    <p class="savings">Épargne (objectifs) : <strong><%= number_to_currency(@savings || 0) %></strong></p>
    <hr>
    <p class="available">💼 Solde disponible : <strong><%= number_to_currency(@available_balance || 0) %></strong></p>
  </div>

  <!-- 🔗 Boutons d’accès -->
  <div class="nav-buttons">
    <%= link_to "Voir mes dépenses", expenses_path, class: "btn btn-danger" %>
    <%= link_to "Voir ma trésorerie", revenues_path, class: "btn btn-success" %>
    <%= link_to "Mes Objectifs", goals_path, class: "btn btn-info" %>
  </div>

<% else %>
  <div class="not-signed-in">
    <p>Pour voir vos finances, connectez-vous.</p>
    <div class="nav-buttons">
      <%= link_to "Se connecter", new_user_session_path, class:"btn btn-primary" %>
      <%= link_to "S'inscrire", new_user_registration_path, class:"btn btn-success" %>
    </div>
  </div>
<% end %>
