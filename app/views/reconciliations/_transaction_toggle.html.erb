<tr class="match-details hidden" id="match-details-<%= tx.id %>">
  <td colspan="7">
    <div class="match-card">

      <% if tx.match_validated? && tx.matchable.present? %>
        <!-- ‚úÖ CAS : MATCH VALID√â -->
        <h2>Rapprochement valid√©</h2>

        <% translated_type =
             case tx.matchable_type
             when "Expense" then "D√©pense"
             when "Revenue" then "Revenu"
             else tx.matchable_type
             end %>

        <p>
          Cette transaction du relev√© est li√©e √† la
          <strong><%= translated_type %></strong> suivante :
        </p>

        <p>
          <strong>Description :</strong> <%= tx.matchable.description %><br>
          <strong>Montant :</strong> <%= number_to_currency(tx.matchable.amount, unit: "‚Ç¨") %><br>
          <strong>Date :</strong> <%= tx.matchable.date&.strftime("%d/%m/%Y") %>
        </p>

        <div class="action-buttons">
          <%= link_to "Modifier cette #{translated_type.downcase}",
                      edit_polymorphic_path(tx.matchable, reconciliation_id: @reconciliation.id),
                      class: "btn btn-edit" %>
        </div>

      <% else %>
        <!-- üîÑ CAS : MATCH NON VALID√â -->

        <% if tx.matchable.present? %>
          <% translated_type =
               case tx.matchable_type
               when "Expense" then "D√©pense"
               when "Revenue" then "Revenu"
               else tx.matchable_type
               end %>

          <strong><%= translated_type %> correspondant propos√©e :</strong><br>
          <em><%= tx.matchable.description %></em><br>
          Montant : <%= number_to_currency(tx.matchable.amount, unit: "‚Ç¨") %><br>
          Date : <%= tx.matchable.date&.strftime("%d/%m/%Y") %><br><br>

          <div class="action-buttons">
            <%= link_to "Modifier cette #{translated_type.downcase}",
                        edit_polymorphic_path(tx.matchable, reconciliation_id: @reconciliation.id),
                        class: "btn btn-edit" %>

            <%= form_with url: validate_match_reconciliation_path(@reconciliation),
                          method: :post,
                          local: true do %>
              <%= hidden_field_tag :tx_id, tx.id %>
              <%= submit_tag "Valider ce rapprochement", class: "btn btn-success" %>
            <% end %>
          </div>
        <% else %>
          <strong>Aucun rapprochement trouv√© automatiquement</strong><br><br>
        <% end %>

        <!-- Boutons de cr√©ation seulement SI le match n'est pas valid√© -->
        <div class="action-buttons">
          <%= link_to "Cr√©er d√©pense",
                      new_expense_path(
                        amount: tx.amount.abs,
                        date: tx.date,
                        description: tx.description,
                        reconciliation_id: @reconciliation.id,
                        tx_id: tx.id
                      ),
                      class: "btn btn-create" %>

          <%= link_to "Cr√©er revenu",
                      new_revenue_path(
                        amount: tx.amount.abs,
                        date: tx.date,
                        description: tx.description,
                        reconciliation_id: @reconciliation.id,
                        tx_id: tx.id
                      ),
                      class: "btn btn-create" %>
        </div>

      <% end %>

    </div>
  </td>
</tr>
