<h1 class="text-center mb-4">Résumé des revenus</h1>

<div style="display:flex; flex-direction:column; align-items:center; gap:20px; margin-bottom:20px;">

  <!-- Formulaire de filtre -->
  <div class="filter-container" style="display:flex; gap:10px; align-items:center;">
    <%= link_to revenues_path, class: "btn btn-success" do %>
      <i class="fas fa-rotate-right"></i>
    <% end %>
    <%= form_with url: revenues_path, method: :get, local: true, class: "d-flex align-items-center gap-2" do %>
      <label>Du :</label>
      <%= date_field_tag :start_date, params[:start_date] || 1.month.ago.to_date, class: "input-field" %>

      <label>Au :</label>
      <%= date_field_tag :end_date, params[:end_date] || Date.today, class: "input-field" %>

      <%= button_tag type: 'submit', class: "btn btn-success" do %>
        <i class="fas fa-search"></i>
      <% end %>
    <% end %>
  </div>

  <!-- Pie chart et légende -->
  <div class="chart-container" style="text-align:center;">
    <canvas
      id="revenues_chart"
      data-controller="transactions-chart"
      data-transactions-chart-resource-value="revenues"
      data-transactions-chart-chart-id-value="revenues_chart"
      data-transactions-chart-categories-value="<%= current_user.categories.for_revenues.to_json(only: [:name, :color]) %>"
      data-transactions-chart-data-by-category-value="<%= @revenues_by_category.to_json %>">
    </canvas>

    <!-- Légende personnalisée -->
    <div id="revenues_chartLegend" style="text-align:center; margin-top:10px;"></div>
  </div>

  <!-- Boutons -->
  <div class="actions-container" style="margin-top:20px;">
    <%= link_to "Ajouter un revenu", new_revenue_path, class: "btn btn-info" %>
    <%= link_to "Gérer les catégories", categories_path(category_type: "revenue"), class: "btn btn-info" %>
  </div>

  <!-- Tableau des revenus -->
  <div class="table-container" data-controller="table-container">
    <table class="styled-table">
      <thead>
        <tr>
          <th data-sort="string">Catégorie</th>
          <th data-sort="string">Description</th>
          <th data-sort="number">Montant</th>
          <th data-sort="date">Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @revenues.each do |revenue| %>
          <tr id="revenue_<%= revenue.id %>" class="category-row" style="--row-color: <%= revenue.category&.color || '#000000' %>;" data-revenue-id="<%= revenue.id %>">
            <td><%= revenue.category&.name || "Default" %></td>
            <td><%= revenue.description %></td>
            <td><%= number_to_currency(revenue.amount, unit: "€") %></td>
            <td><%= revenue.date %></td>
            <td class="actions-cell">
              <%= link_to edit_revenue_path(revenue), class: "btn btn-supp", title: "Éditer" do %>
                <i class="fas fa-pencil-alt"></i>
              <% end %>
              <%= button_to revenue_path(revenue), method: :delete, form: { data: { turbo_confirm: "Voulez-vous vraiment supprimer ce revenu ?" } }, class: "btn btn-danger", title: "Supprimer" do %>
                <i class="fas fa-trash-alt"></i>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
