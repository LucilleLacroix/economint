<h1 style="text-align:center;">Résumé des dépenses</h1>

<div style="display:flex; flex-direction:column; align-items:center; gap:20px; margin-bottom:20px;">
  <!-- Formulaire de filtre -->
  <div class="filter-container">
    <%= form_with url: expenses_path, method: :get, local: true, class: "filter-form" do %>
      <label>Du :</label>
      <%= date_field_tag :start_date, params[:start_date] || 1.month.ago.to_date, class: "input-field" %>
      <label>Au :</label>
      <%= date_field_tag :end_date, params[:end_date] || Date.today, class: "input-field" %>
      <%= submit_tag "Filtrer", class: "btn-main" %>
      <%= link_to "Réinitialiser", expenses_path, class: "btn-cancel" %>
    <% end %>
  </div>


  <!-- Pie chart avec Stimulus -->
  <div class="chart-container">
    <canvas id="expensesChart"
            data-controller="transactions-chart"
            data-transactions-chart-resource-value="expenses"
            data-transactions-chart-chart-id-value="expensesChart"
            data-transactions-chart-categories-value='<%= raw current_user.categories.for_expenses.to_json(only: [:name, :color]) %>'
            data-transactions-chart-data-by-category='<%= raw @expenses_by_category.to_json %>'>
    </canvas>
  </div>


  <!-- Boutons -->
  <div class="actions-container">
    <%= link_to "Ajouter une dépense", new_expense_path, class: "btn-main" %>
    <%= link_to "Gérer les catégories", categories_path(category_type: "expense"), class: "btn-cancel" %>
  </div>


<!-- Tableau des dépenses -->
<div class="table-container">
  <table class="styled-table">
    <thead>
      <tr>
        <th>Catégorie</th>
        <th>Description</th>
        <th>Montant</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @expenses.each do |expense| %>
        <tr data-expense-id="<%= expense.id %>">
          <td><%= expense.category&.name || "Default" %></td>
          <td><%= expense.description %></td>
          <td><%= number_to_currency(expense.amount) %></td>
          <td><%= expense.date %></td>
          <td class="actions-cell">
            <%= link_to "Éditer", edit_expense_path(expense), class: "btn-small btn-warning" %>
            <button class="btn-small btn-danger delete-expense" data-id="<%= expense.id %>">Supprimer</button>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
